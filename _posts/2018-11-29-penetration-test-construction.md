---
title: 渗透测试建设
description: 持续更新我的企业安全渗透测试建设经验
categories:
 - gitcheck
tags:
 - 渗透测试
 - 安全建设
---

2018-11-29 v0.1：工作一年零4个月，甲方安全工程师，负责内外网Web渗透测试以及安全工具开发，安全管理、移动终端、内网渗透、网络运维构架等只知道些概念，自己没有上手过，不懂细节，不作涉及，这里主要写一些我做过的能care到的部分

初到一个公司如何进行渗透测试建设，做的事情要领导支持，看支持到什么程度做什么事情，我试过不给测试环境和测试账号要你走通全流程不能出漏洞，也有线上业务不能扫描扫挂了谁赔啊

### 一期
#### 建设攻防平台
搭建内容（可以根据要检查的点和公司实际情况不断补充）

* OS: Linxu、Windows
* 服务中间件：Nginx、Apache、Redis、RabbitMQ、SSH、MySQL等
* 靶机：WebGoat、DVWA、sqli-labs和根据需要检查的漏洞自己搭建的应用
* 工具：
    * 服务扫描：masscan、nmap
    * 主机扫描：Nessus、Nexpose
    * Web扫描：AWVS或者其他
    * 代理接口扫描：Burp Suite、AppSpider
    * 其他：Kali、metasploit、自研工具等
* 漏洞知识库

作用：

私有网络的漏洞攻防平台，多人用，用于帮助开发了解漏洞和安全新人培养，也做漏洞复现和扫描器开发、规则改进的测试环境

漏洞知识库用于开发了解漏洞和了解修复方式，可在内网工单系统和攻防平台的环境中各同步一份，前期可以用OWASP渗透测试指南代替，可以慢慢新增自己的，确保正确详细，不是博客上抄来抄去的

#### 蜜罐、DNSlog
此块未自己上手做过，暂不涉及

作用：

用于内网盲打，用户黑盒检测时外网盲打内网等一些漏洞，目标为蜜罐和通过DNSlog等结果，提高检测准确率

蜜罐等原本作用没有实际操作过，暂不涉及

#### 资产梳理
IP、Domain、主机、网络设备、数据库、应用程序，根据网络情况进行梳理，内外网，不同域要分类梳理，也要对资产进行优先级分类

资产获取根据情况最好变成变动有接口推送的形式，方便渗透和运营的扫描器获取最新数据

#### 字典制作
方式：
制作字典的信息来源包括和做法包括:

作用：
暴力破解用的字典和敏感信息检查用和url管理台暴破的字典，并将字典作为接口提供，方便维护更改其他扫描器获取最新字典

#### 漏洞闭环
方式：看企业以后的工单系统，最好能将安全漏洞直接作为Bug单放到开发他们自己的工单系统中

作用：漏洞闭环

#### 主机黑盒检查
方式：

* 基本信息检查：nmap扫描获取机器开放端口信息，获取的信息分类待用
* 系统版本、开放端口组件漏洞检查：Nessus、Nexpose，CVE有十几万，主机侧等检测靠商业扫描器应该是比较好的，Web一些框架兴许自研的更准确，没钱可以试用版先扫描一遍，自研还是维护成本高（维护人员能力和跳槽等不确定因素，而且我感觉大家漏洞预警全靠朋友圈。。。）
* 授权弱口令检查：用之前获取的字典，自写脚本，Medusa暴破
* 检查点:
* 检查后总结漏洞，更新原始镜像系统（主机镜像、Docker镜像），使新增机器默认安全

作用：发掘主机的安全漏洞，提出漏洞修补建议

#### 应用黑盒渗透测试
方式：
根据梳理出来的资产优先级进行分批渗透，一般外网大于内网，公开的大于与合作方的服务，用户入口要把握好
检查点：
* 维护渗透测试检查列表

作用：发掘应用的安全漏洞，提出漏洞修补建议

### 二期
#### 安全预警和应急保障

#### 源代码安全扫描
方式：
* XXE等漏洞可以代码匹配字段检测，能比较准，一些这种漏洞等检测规则
* OWASP的Dependency-Check依赖库版本检查
* 有钱Fortify扫一下

作用：可以检测一些代码风险

#### 扫描器例行化运营
管理台（有精力页面，无精力命令行一样的）分发扫描任务，根据实际情况按每日每周等一些间隔例行化扫描，每次扫描结束邮件通知，专人负责查看

#### 上线/变更管理
上线需要经过工单，资产需要增加到例行化的扫描器中，业务不多需要经过渗透测试，多的化按优先级（或者1.0,1.5这种版本）

### 三期
#### 安全评估与加固
主机操作系统、网络设备、数据库、应用程序的安全检查发掘安全缺陷和错误配置

#### 重点项目代码检查

#### SDL建设

### 四期
#### 主机检测系统

#### WAF

#### SRC
