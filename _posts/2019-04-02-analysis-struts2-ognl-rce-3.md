---
title: struts2基于OGNL的RCE漏洞分析3——看修复历史和一些思考
description: 承接上两篇，先通过上两篇的分析说说数据流转，然后看struts2的修复历史，在谈自己的一些思考
categories:
 - 漏洞分析
tags:
 - 漏洞分析
---

### 0x00 Web框架中的数据流转
上两篇文章中我常常讲到数据流转，这个是从《Struts2 技术内幕——深入解析Struts2架构设计与实现原理》这本书中学来的词汇，我以前关于Struts2框架的分析文章也有很多是基于这本书的

书中对数据流转是这么说的，网络中传输的是二进制或者字符类型的数据，是弱类型的，而Java世界是一个强类型的，而且可以自定义类型，为了方便这种类型转换，就使用了表达式引擎，也就是OGNL表达式引擎

其实SQL注入也是一样，HTTP协议的传送的二进制或者字符类型，语言是强类型的，然后SQL语言是弱类型的，经过这样的类型转换，就形成了注入漏洞

所以Struts2的OGNL的RCE其实也都是注入漏洞

Struts2框架设计上有一个目的，就是将XWork和容器的Servlet分开，也就是重新封装HttpServletRequest和HttpServletResponse，将传入的参数直接传到Action的属性中去

这样设计很灵活，可以将HTTP参数转变成Java自定义的对象，也留下的隐患，HTTP数据和Java世界中就像SQL注入一样增加了一个OGNL表达式，所以注入就能够这样出现，而OGNL比SQL注入更厉害的是很容易代码执行

过于灵活的数据流转就是漏洞产生主要因素，我想这在所有的Web框架中都有参考意义

### 0x01 Struts2基于OGNL的RCE的修复历史


### 0x02 思考，为什么修不好
